{
  "bsonType": "object",
  "required": ["siteId", "workerId", "user_id", "createTime", "updateTime"],
  "permission": {
    "read": "doc.user_id == auth.uid",
    "create": "auth.uid != null",
    "update": "doc.user_id == auth.uid",
    "delete": "doc.user_id == auth.uid"
  },
  "properties": {
    "_id": {
      "description": "ID，系统自动生成"
    },
    "siteId": {
      "bsonType": "string",
      "title": "工地ID",
      "description": "工地ID（关联sites._id）",
      "foreignKey": "sites._id"
    },
    "workerId": {
      "bsonType": "string",
      "title": "工人ID",
      "description": "工人ID（关联workers._id）",
      "foreignKey": "workers._id"
    },
    "user_id": {
      "bsonType": "string",
      "title": "创建者用户ID",
      "description": "创建者用户ID",
      "foreignKey": "uni-id-users._id"
    },
    "createTime": {
      "bsonType": "timestamp",
      "title": "创建时间",
      "description": "创建时间",
      "defaultValue": {
        "$env": "now"
      }
    },
    "updateTime": {
      "bsonType": "timestamp",
      "title": "更新时间",
      "description": "更新时间",
      "defaultValue": {
        "$env": "now"
      }
    }
  },
  "index": [{
    "IndexName": "user_id_index",
    "MgoKeySchema": {
      "MgoIndexKeys": [{
        "Name": "user_id",
        "Direction": "1"
      }]
    }
  }, {
    "IndexName": "user_id_site_index",
    "MgoKeySchema": {
      "MgoIndexKeys": [{
        "Name": "user_id",
        "Direction": "1"
      }, {
        "Name": "siteId",
        "Direction": "1"
      }]
    }
  }, {
    "IndexName": "user_id_worker_index",
    "MgoKeySchema": {
      "MgoIndexKeys": [{
        "Name": "user_id",
        "Direction": "1"
      }, {
        "Name": "workerId",
        "Direction": "1"
      }]
    }
  }, {
    "IndexName": "site_worker_unique_index",
    "MgoKeySchema": {
      "MgoIndexKeys": [{
        "Name": "siteId",
        "Direction": "1"
      }, {
        "Name": "workerId",
        "Direction": "1"
      }, {
        "Name": "user_id",
        "Direction": "1"
      }],
      "MgoIsUnique": true
    }
  }]
} 